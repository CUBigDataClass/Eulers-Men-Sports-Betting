{% extends "layout.html" %}
{% block content %}
  <h2>EU Football league betting data!<h2>
    <form class="mb-5" method="POST">
      {{ form.csrf_token }}
      <div class="form-group">
        {{ form.league.label(class="form-control-label") }}
        {{ form.league(class="form-control form-control-lg") }}
      </div>
      <div class="form-group">
        {{ form.team1.label(class="form-control-label") }}
        {{ form.team1(class="form-control form-control-lg") }}
      </div>
      <div class="form-group">
        {{ form.team2.label(class="form-control-label") }}
        {{ form.team2(class="form-control form-control-lg") }}
      </div>
      <div class="form-group">
        {{ form.submit(class="btn btn-outline-info") }}
      </div>
    </form>

    <canvas id="myChart"></canvas>

    <div class="container-graph">
      {% if league %}
        <h2>League: {{ league }}</h2>
        <h3>Team 1: {{ team1 }}</h3>
        <h3>Team 2: {{ team2 }}</h3>
        {% for row in teams_record %}
          <h4><b>Date:</b> {{ row[0] }} <b>Home:</b> {{ row[1] }} <b>Away:</b> {{ row[2] }} <b>Winner:</b> {{ row[3] }}</h4>
        {% endfor %}
      {% endif %}
    </div>

    <script>
      let user_league = document.getElementById('league');
      let user_team1 = document.getElementById('team1');
      let user_team2 = document.getElementById('team2');

      user_league.onchange = function() {
        league = user_league.value;

        fetch('/' + league).then(function(response) {
          response.json().then(function(data) {
            let optionHTML = '';
            for (let team of data.teams) {
              optionHTML += '<option>' + team.name + '</option>';
            }

            user_team1.innerHTML = optionHTML;
            user_team2.innerHTML = optionHTML;
          });
        });
      }

      //Global Chart options
      Chart.defaults.global.defaultFontSize = 18;
      Chart.defaults.global.defauultFontColor = '#777';

      let chartElement = document.getElementById('myChart').getContext('2d');
      let chart = new Chart(chartElement, {
        type:'line',
        data:{
          labels:["1", "2", "3", "4", "5", "6"],
          datasets:[{
            label: 'Something Cool',
            data:[
              1,
              2,
              3,
              2.75,
              2.5,
              1
            ],
            borderWidth: 1.5,
            borderColor: '#4682b4',
            hoverBorderWidth: 2,

            backgroundColor: 'blue',
            pointBackgroundColor: 'blue',
            pointBorderColor: 'black',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,

            fill: false,
            lineTension: 0.01,
          },
          {
            label: 'Something Cooler',
            data:[
              4,
              2.5,
              3,
              1
            ],

            borderWidth: 1.5,
            borderColor: '#cd5c5c',
            hoverBorderWidth: 2,

            backgroundColor: 'red',
            pointBackgroundColor: 'red',
            pointBorderColor: 'black',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,

            fill: false,
            lineTension: 0.01,
          }]
        },
        options:{
          title: {
            display: true,
            text: 'A Good Title',
            fontSize: 25
          },
          legend: {
            position: 'bottom',
          },
          tooltips: {
            position: 'nearest'
          },
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
    </script>
{% endblock content %}
